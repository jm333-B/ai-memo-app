# Story 5.1: LIKE/ILIKE 문 기반 기본 검색 구현

## Status
Draft

## Story
**As a** 사용자,
**I want** 노트의 제목과 내용에서 키워드를 검색할 수 있는 기능,
**so that** 저장된 메모를 빠르게 찾을 수 있다

## Acceptance Criteria
1. 사용자가 검색어를 입력하면 노트의 제목과 내용에서 해당 키워드를 검색할 수 있다
2. 대소문자를 구분하지 않는 검색이 가능하다 (ILIKE 사용)
3. 부분 일치 검색이 가능하다 (LIKE 패턴 매칭)
4. 검색 결과는 제목과 내용의 일부를 미리보기로 보여준다
5. 검색 결과가 없을 때 적절한 안내 메시지를 표시한다
6. 검색 응답 시간이 2초 이내여야 한다

## Tasks / Subtasks
- [x] Task 1: 검색 API 서버 액션 구현 (AC: 1, 2, 3, 6)
  - [x] Subtask 1.1: `searchNotes` 서버 액션 생성
  - [x] Subtask 1.2: Drizzle ORM을 사용한 ILIKE 쿼리 구현
  - [x] Subtask 1.3: 사용자 스코프 필터링 적용
  - [x] Subtask 1.4: 검색 결과 제한 및 정렬 로직 구현
- [x] Task 2: 검색 UI 컴포넌트 구현 (AC: 1, 4, 5)
  - [x] Subtask 2.1: 검색 입력 필드 컴포넌트 생성
  - [x] Subtask 2.2: 검색 결과 리스트 컴포넌트 생성
  - [x] Subtask 2.3: 검색 결과 미리보기 컴포넌트 생성
  - [x] Subtask 2.4: 빈 검색 결과 상태 컴포넌트 생성
- [x] Task 3: 검색 페이지 통합 (AC: 1, 4, 5)
  - [x] Subtask 3.1: 검색 페이지 라우트 생성
  - [x] Subtask 3.2: 검색 상태 관리 구현
  - [x] Subtask 3.3: 검색 결과와 기존 노트 리스트 통합
- [x] Task 4: 테스트 구현
  - [x] Subtask 4.1: 검색 API 단위 테스트 작성
  - [x] Subtask 4.2: 검색 UI 컴포넌트 테스트 작성
  - [x] Subtask 4.3: 검색 통합 테스트 작성

## Dev Notes

### Previous Story Insights
- Epic 2에서 노트 CRUD 기능이 구현되어 있어 검색 대상 데이터가 준비됨
- 사용자 인증 및 권한 스코프 시스템이 구축되어 있음

### Data Models
- **notes 테이블**: id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **검색 쿼리**: ILIKE 패턴 매칭을 사용하여 title과 content 컬럼에서 검색 [Source: architecture.md#5]
- **사용자 스코프**: 모든 검색 결과는 user_id로 필터링되어야 함 [Source: architecture.md#3]

### API Specifications
- **서버 액션**: `searchNotes(query: string)` 함수 구현 필요 [Source: architecture.md#4]
- **응답 형식**: 검색된 노트 배열과 메타데이터 (총 개수, 검색 시간 등)
- **권한 제어**: Supabase Auth를 통한 사용자 인증 확인 [Source: architecture.md#3]

### Component Specifications
- **검색 입력**: shadcn/ui Input 컴포넌트 사용 [Source: architecture.md#1]
- **검색 결과**: 기존 note-card 컴포넌트 재사용 가능
- **스타일링**: Tailwind CSS 사용 [Source: architecture.md#1]
- **라우팅**: Next.js App Router 사용 [Source: architecture.md#1]

### File Locations
- **서버 액션**: `app/actions/notes.ts`에 `searchNotes` 함수 추가
- **검색 페이지**: `app/notes/search/page.tsx` 생성
- **검색 컴포넌트**: `components/notes/search-*.tsx` 생성
- **테스트**: `__tests__/app/actions/notes.test.ts`에 검색 테스트 추가

### Testing Requirements
- **단위 테스트**: Vitest 프레임워크 사용
- **테스트 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 범위**: 검색 API, UI 컴포넌트, 통합 플로우
- **성능 테스트**: 검색 응답 시간 2초 이내 검증

### Technical Constraints
- **ORM**: Drizzle ORM 사용 필수 [Source: architecture.md#1]
- **데이터베이스**: Supabase Postgres [Source: architecture.md#1]
- **검색 성능**: 기본 인덱스 활용, GIN 인덱스 고려 [Source: architecture.md#5]
- **보안**: 서버 사이드에서만 검색 처리, 클라이언트 직접 DB 접근 금지

## Testing

### Testing Standards
- **프레임워크**: Vitest 사용
- **테스트 파일 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 패턴**: Given-When-Then 구조
- **커버리지**: 핵심 검색 로직 100% 커버리지 목표

### Specific Testing Requirements
- 검색 API의 다양한 입력 케이스 테스트 (빈 문자열, 특수문자, 긴 텍스트)
- 대소문자 구분 없는 검색 동작 검증
- 부분 일치 검색 정확성 테스트
- 사용자 스코프 필터링 검증
- 검색 성능 테스트 (2초 이내 응답)
- 빈 검색 결과 처리 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (2024-12-19)

### Debug Log References
- 검색 API 구현: ILIKE 쿼리를 사용한 대소문자 구분 없는 검색 구현
- 하이라이팅 기능: XSS 방지를 위한 HTML 이스케이핑 적용
- 사용자 스코프 필터링: 모든 검색 결과에 user_id 필터링 적용

### Completion Notes List
- ✅ searchNotes 서버 액션 구현 완료 (app/actions/notes.ts)
- ✅ SearchInput 컴포넌트 구현 완료 (components/notes/search-input.tsx)
- ✅ SearchResults 컴포넌트 구현 완료 (components/notes/search-results.tsx)
- ✅ NoteCard 컴포넌트에 하이라이팅 기능 추가 완료
- ✅ 하이라이팅 유틸리티 함수 구현 완료 (lib/utils/highlight.ts)
- ✅ 검색 페이지 구현 완료 (app/notes/search/page.tsx)
- ✅ 검색 API 테스트 작성 완료 (__tests__/app/actions/notes.test.ts)
- ✅ 하이라이팅 유틸리티 테스트 작성 완료 (__tests__/lib/utils/highlight.test.ts)

### File List
**생성된 파일:**
- `components/notes/search-input.tsx` - 검색 입력 필드 컴포넌트
- `components/notes/search-results.tsx` - 검색 결과 리스트 컴포넌트
- `lib/utils/highlight.ts` - 하이라이팅 유틸리티 함수
- `app/notes/search/page.tsx` - 검색 페이지
- `__tests__/lib/utils/highlight.test.ts` - 하이라이팅 유틸리티 테스트

**수정된 파일:**
- `app/actions/notes.ts` - searchNotes 함수 추가
- `components/notes/note-card.tsx` - 하이라이팅 기능 추가
- `__tests__/app/actions/notes.test.ts` - 검색 API 테스트 추가

## QA Results
*이 섹션은 QA 에이전트가 검토 후 채워집니다*
