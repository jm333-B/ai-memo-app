# Story 5.2: 통합 검색 인터페이스 구현

## Status
Draft

## Story
**As a** 사용자,
**I want** 노트 목록 페이지에서 통합된 검색 인터페이스를 사용할 수 있는 기능,
**so that** 별도 페이지 이동 없이 바로 검색할 수 있다

## Acceptance Criteria
1. 노트 목록 페이지 상단에 검색 입력 필드가 표시된다
2. 검색어 입력 시 실시간으로 검색 결과가 업데이트된다
3. 검색 중일 때는 기존 노트 목록이 검색 결과로 대체된다
4. 검색어를 지우면 원래 노트 목록이 복원된다
5. 검색 결과와 일반 노트 목록 간의 전환이 부드럽게 이루어진다
6. 검색 상태가 URL에 반영되어 새로고침 시에도 유지된다

## Tasks / Subtasks
- [x] Task 1: 통합 검색 컴포넌트 구현 (AC: 1, 2, 3, 4)
  - [x] Subtask 1.1: 검색 입력 필드 컴포넌트 생성
  - [x] Subtask 1.2: 검색 상태 관리 훅 구현
  - [x] Subtask 1.3: 검색 결과와 일반 목록 전환 로직 구현
  - [x] Subtask 1.4: 검색어 초기화 기능 구현
- [x] Task 2: 노트 목록 페이지 통합 (AC: 1, 5)
  - [x] Subtask 2.1: 기존 노트 목록 페이지에 검색 컴포넌트 추가
  - [x] Subtask 2.2: 검색 상태와 노트 목록 상태 통합 관리
  - [x] Subtask 2.3: 검색 결과 렌더링 로직 구현
- [x] Task 3: URL 상태 관리 (AC: 6)
  - [x] Subtask 3.1: 검색 쿼리 파라미터 관리
  - [x] Subtask 3.2: URL 변경 시 검색 상태 복원
  - [x] Subtask 3.3: 브라우저 히스토리 관리
- [x] Task 4: 테스트 구현
  - [x] Subtask 4.1: 통합 검색 컴포넌트 테스트
  - [x] Subtask 4.2: 검색 상태 관리 테스트
  - [x] Subtask 4.3: URL 상태 관리 테스트

## Dev Notes

### Previous Story Insights
- Story 5.1에서 기본 검색 API가 구현되어 있어 검색 기능을 활용 가능
- 기존 노트 목록 컴포넌트 구조를 참고하여 통합 인터페이스 설계

### Data Models
- **검색 상태**: query, results, isLoading, hasSearched [Source: architecture.md#4]
- **URL 파라미터**: search 쿼리 파라미터로 검색어 관리
- **노트 데이터**: 기존 notes 테이블 구조 활용 [Source: architecture.md#2]

### API Specifications
- **검색 API**: Story 5.1에서 구현된 `searchNotes` 함수 재사용
- **상태 관리**: React useState/useEffect 훅 활용
- **URL 관리**: Next.js useRouter, useSearchParams 훅 사용

### Component Specifications
- **검색 입력**: shadcn/ui Input 컴포넌트 사용 [Source: architecture.md#1]
- **통합 레이아웃**: 기존 notes-list 컴포넌트와 검색 컴포넌트 조합
- **상태 표시**: 검색 중 로딩 상태, 빈 결과 상태 처리
- **스타일링**: Tailwind CSS 사용 [Source: architecture.md#1]

### File Locations
- **검색 컴포넌트**: `components/notes/integrated-search.tsx` 생성
- **검색 훅**: `hooks/use-integrated-search.ts` 생성
- **노트 목록 페이지**: `app/notes/page.tsx` 수정
- **테스트**: `__tests__/components/notes/integrated-search.test.tsx` 생성

### Testing Requirements
- **단위 테스트**: Vitest 프레임워크 사용
- **테스트 범위**: 검색 컴포넌트, 상태 관리, URL 파라미터 처리
- **통합 테스트**: 검색과 노트 목록 간 상호작용 검증

### Technical Constraints
- **프레임워크**: Next.js App Router 사용 [Source: architecture.md#1]
- **상태 관리**: React 훅 기반 클라이언트 상태 관리
- **URL 관리**: Next.js 라우터 API 활용
- **성능**: 검색 입력 디바운싱으로 API 호출 최적화

## Testing

### Testing Standards
- **프레임워크**: Vitest 사용
- **테스트 파일 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 패턴**: Given-When-Then 구조

### Specific Testing Requirements
- 검색 입력 필드 렌더링 및 동작 테스트
- 검색 상태 변경 시 UI 업데이트 검증
- URL 파라미터와 검색 상태 동기화 테스트
- 검색어 초기화 시 원래 목록 복원 테스트
- 검색 결과와 일반 목록 간 전환 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (2024-12-19)

### Debug Log References
- 통합 검색 훅 구현: URL 파라미터와 검색 상태 동기화
- 노트 목록 페이지 클라이언트 컴포넌트 변환: 서버 컴포넌트에서 클라이언트 컴포넌트로 변경
- 컴포넌트 prop 확장: SortDropdown과 Pagination에 콜백 prop 추가

### Completion Notes List
- ✅ useIntegratedSearch 훅 구현 완료 (hooks/use-integrated-search.ts)
- ✅ IntegratedSearch 컴포넌트 구현 완료 (components/notes/integrated-search.tsx)
- ✅ 노트 목록 페이지 통합 검색 기능 추가 완료 (app/notes/page.tsx)
- ✅ SortDropdown 컴포넌트 onSortChange prop 추가 완료
- ✅ Pagination 컴포넌트 onPageChange prop 추가 완료
- ✅ 통합 검색 컴포넌트 테스트 작성 완료 (__tests__/components/notes/integrated-search.test.tsx)
- ✅ 통합 검색 훅 테스트 작성 완료 (__tests__/hooks/use-integrated-search.test.ts)

### File List
**생성된 파일:**
- `hooks/use-integrated-search.ts` - 통합 검색 상태 관리 훅
- `components/notes/integrated-search.tsx` - 통합 검색 컴포넌트
- `__tests__/components/notes/integrated-search.test.tsx` - 통합 검색 컴포넌트 테스트
- `__tests__/hooks/use-integrated-search.test.ts` - 통합 검색 훅 테스트

**수정된 파일:**
- `app/notes/page.tsx` - 통합 검색 기능 추가 및 클라이언트 컴포넌트 변환
- `components/notes/sort-dropdown.tsx` - onSortChange prop 추가
- `components/notes/pagination.tsx` - onPageChange prop 추가

## QA Results
*이 섹션은 QA 에이전트가 검토 후 채워집니다*
