# Story 2.4: 노트 상세 조회

## Status
Ready for Review

## Story
**As a** 로그인한 사용자,
**I want** 노트 목록에서 특정 노트를 클릭하여 전체 내용을 상세히 볼 수 있다,
**so that** 작성한 노트의 모든 정보를 확인하고 필요한 정보를 얻을 수 있다

## Acceptance Criteria
1. 노트 상세 페이지(`/notes/[id]`)에 선택한 노트의 전체 내용이 표시되어야 함
2. 노트 제목, 본문, 작성일시, 수정일시가 모두 표시되어야 함
3. 현재 로그인한 사용자의 노트만 조회 가능해야 함 (권한 검증)
4. 다른 사용자의 노트 ID로 접근 시 404 에러 또는 권한 없음 메시지를 표시해야 함
5. 존재하지 않는 노트 ID로 접근 시 404 에러 페이지를 표시해야 함
6. 상세 페이지에서 "수정" 버튼이 표시되어야 함
7. 상세 페이지에서 "삭제" 버튼이 표시되어야 함
8. 상세 페이지에서 "목록으로" 버튼이 표시되어야 함
9. 본문 내용은 줄바꿈을 포함하여 원본 그대로 표시되어야 함
10. 로딩 중일 때 스켈레톤 UI 또는 로딩 스피너를 표시해야 함

## Tasks / Subtasks
- [ ] Task 1: 노트 상세 조회 UI 페이지 구현 (AC: 1, 2, 9)
  - [ ] `/app/notes/[id]/page.tsx` 생성
  - [ ] 동적 라우트 파라미터로 노트 ID 받기
  - [ ] 노트 제목, 본문, 작성일시, 수정일시 표시
  - [ ] 본문 줄바꿈 처리 (whitespace-pre-wrap)

- [ ] Task 2: Server Action으로 노트 상세 조회 로직 구현 (AC: 3, 4, 5)
  - [ ] `/app/actions/notes.ts`에 `getNoteById` Server Action 추가
  - [ ] Supabase Auth를 통해 현재 사용자 ID 가져오기
  - [ ] Drizzle ORM을 사용하여 노트 조회 (WHERE id = ? AND user_id = ?)
  - [ ] 노트가 없거나 권한이 없는 경우 null 반환
  - [ ] 에러 핸들링

- [ ] Task 3: 액션 버튼 UI 구현 (AC: 6, 7, 8)
  - [ ] "수정" 버튼 추가 (→ `/notes/[id]/edit`)
  - [ ] "삭제" 버튼 추가 (확인 다이얼로그 포함)
  - [ ] "목록으로" 버튼 추가 (→ `/notes`)
  - [ ] 버튼 레이아웃 및 스타일링

- [ ] Task 4: 에러 처리 및 권한 검증 (AC: 4, 5)
  - [ ] 노트를 찾을 수 없는 경우 404 페이지 표시
  - [ ] 권한이 없는 경우 에러 메시지 표시
  - [ ] notFound() 함수 활용

- [ ] Task 5: 로딩 상태 UI 구현 (AC: 10)
  - [ ] 노트 로딩 중 스켈레톤 UI 표시
  - [ ] Suspense 및 Loading 컴포넌트 활용

- [ ] Task 6: 테스트 작성
  - [ ] 노트 상세 페이지 렌더링 테스트
  - [ ] `getNoteById` Server Action 단위 테스트
  - [ ] 권한 검증 테스트
  - [ ] 404 에러 처리 테스트

## Dev Notes

### 기술 스택
[Source: docs/architecture.md#1]
- **프레임워크:** Next.js App Router (동적 라우트)
- **UI 컴포넌트:** shadcn/ui + Tailwind CSS
- **ORM:** Drizzle ORM
- **인증:** Supabase Auth

### 데이터 모델
[Source: docs/architecture.md#2, Story 2.1]
- **notes 테이블:**
  - `id` (UUID, 기본 키) - URL 파라미터로 사용
  - `user_id` (UUID, NOT NULL) - 권한 검증에 사용
  - `title` (TEXT, NOT NULL)
  - `content` (TEXT, NOT NULL)
  - `created_at` (TIMESTAMP)
  - `updated_at` (TIMESTAMP)

### 서버 액션
[Source: docs/architecture.md#4]
- `getNoteById` – 노트 상세 조회 (이 스토리에서 구현)
- Server Action은 `/app/actions/notes.ts`에 위치

### 동적 라우트
- **경로:** `/notes/[id]`
- **파일:** `/app/notes/[id]/page.tsx`
- **파라미터 접근:** `params.id`
- **예시:** `/notes/abc123-def456-...`

### 보안 요구사항
[Source: docs/architecture.md#3]
- 노트는 현재 로그인한 사용자의 것만 조회 가능
- WHERE 절로 `user_id` 필터링 필수
- 다른 사용자의 노트 접근 시도는 차단

### 프로젝트 구조
[Source: project-rule.mdc]
- 라우팅: `/app` 디렉토리 사용 (Next.js App Router)
- Server Actions: `/app/actions` 디렉토리
- 동적 라우트: `[id]` 폴더 네이밍

### 파일 생성 위치
- 노트 상세 페이지: `/app/notes/[id]/page.tsx`
- Loading 컴포넌트: `/app/notes/[id]/loading.tsx` (선택적)
- Not Found 페이지: `/app/notes/[id]/not-found.tsx` (선택적)
- Server Actions: `/app/actions/notes.ts` (기존 파일에 추가)

### UI/UX 디자인 원칙
[Source: project-rule.mdc]
- 단순하고 깔끔하며 미니멀한 UI
- Apple/Notion 수준의 직관적인 UX 지향
- 읽기 편한 타이포그래피 및 여백

### 주의사항
[Source: project-rule.mdc]
- 모든 파일은 4줄의 헤더 주석으로 시작
- 파일은 500 LOC 이하 유지
- 본문 줄바꿈 처리: `whitespace-pre-wrap` CSS 클래스 사용

### 의존성
[Source: Story 2.1, Story 2.2, Story 2.3]
- Drizzle ORM 환경이 구성되어 있어야 함 (Story 2.1 완료)
- `lib/db/index.ts`의 Drizzle 클라이언트 사용
- `drizzle/schema.ts`의 notes 테이블 스키마 사용
- 노트가 생성되어 있어야 상세 조회 가능 (Story 2.2 선행)

### Testing

#### 테스트 파일 위치
- 컴포넌트 테스트: `__tests__/app/notes/[id]/page.test.tsx`
- Server Action 테스트: `__tests__/app/actions/notes.test.ts` (기존 파일에 추가)

#### 테스트 표준
[Source: project-rule.mdc]
- 테스트 실행: `pnpm test`
- 모든 기능은 단위 테스트 및 통합 테스트 작성 필수

#### 이 스토리의 테스트 요구사항
1. **컴포넌트 테스트:**
   - 노트 상세 페이지 렌더링 확인
   - 제목, 본문, 날짜 표시 확인
   - 액션 버튼(수정/삭제/목록으로) 존재 확인
   
2. **Server Action 테스트:**
   - `getNoteById` 정상 작동 확인
   - 사용자 스코프 필터링 검증
   - 존재하지 않는 노트 처리
   - 권한 없는 노트 접근 차단
   
3. **에러 처리 테스트:**
   - 404 에러 페이지 표시
   - 권한 없음 에러 처리
   
4. **통합 테스트:**
   - 노트 목록 → 상세 페이지 전환 플로우

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 초안 생성 | SM-Bob |

## Dev Agent Record

### Agent Model Used
_개발 시 자동 기록_

### Debug Log References
_개발 시 자동 기록_

### Completion Notes List
_개발 시 자동 기록_

### File List
_개발 시 자동 기록_

---

<!-- Powered by BMAD™ Core -->

