# Story 5.4: 날짜 범위 필터링

## Status
Done

## Story
**As a** 사용자,
**I want** 특정 날짜 범위로 노트를 필터링할 수 있는 기능,
**so that** 특정 기간에 작성된 메모들을 찾을 수 있다

## Acceptance Criteria
1. 사용자가 시작일과 종료일을 선택하여 날짜 범위를 설정할 수 있다
2. 날짜 범위 필터가 적용되면 해당 기간에 생성된 노트만 표시된다
3. 날짜 필터와 검색어, 태그 필터를 함께 사용할 수 있다
4. 미리 정의된 날짜 범위 옵션을 제공한다 (오늘, 이번 주, 이번 달, 최근 30일)
5. 선택된 날짜 범위가 시각적으로 표시되고 초기화가 가능하다
6. 날짜 범위별 노트 개수가 표시된다

## Tasks / Subtasks
- [x] Task 1: 날짜 필터링 API 구현 (AC: 1, 2, 3)
  - [x] Subtask 1.1: `filterNotesByDateRange` 서버 액션 생성
  - [x] Subtask 1.2: 날짜 범위 쿼리 구현 (created_at 기준)
  - [x] Subtask 1.3: 날짜 필터와 검색어, 태그 필터 조합 쿼리 구현
  - [x] Subtask 1.4: 사용자 스코프 필터링 적용
- [x] Task 2: 날짜 선택 UI 구현 (AC: 1, 4, 5)
  - [x] Subtask 2.1: 날짜 범위 선택 컴포넌트 생성
  - [x] Subtask 2.2: 미리 정의된 날짜 범위 옵션 구현
  - [x] Subtask 2.3: 선택된 날짜 범위 표시 및 초기화 기능
  - [x] Subtask 2.4: 날짜 범위별 노트 개수 표시 기능
- [x] Task 3: 필터 상태 관리 (AC: 3, 5)
  - [x] Subtask 3.1: 날짜 필터 상태 관리 훅 구현
  - [x] Subtask 3.2: 다중 필터 조합 상태 관리
  - [x] Subtask 3.3: 필터 초기화 기능 구현
- [x] Task 4: 테스트 구현
  - [x] Subtask 4.1: 날짜 필터링 API 테스트
  - [x] Subtask 4.2: 날짜 선택 UI 테스트
  - [x] Subtask 4.3: 다중 필터 조합 테스트

## Dev Notes

### Previous Story Insights
- Story 5.1, 5.2, 5.3에서 검색 및 태그 필터링이 구현되어 있어 날짜 필터와 조합 가능
- notes 테이블의 created_at 컬럼을 활용하여 날짜 기반 필터링 구현

### Data Models
- **notes 테이블**: created_at 컬럼 활용 [Source: architecture.md#2]
- **날짜 필터 상태**: startDate: Date, endDate: Date, isActive: boolean
- **미리 정의된 범위**: today, thisWeek, thisMonth, last30Days
- **사용자 스코프**: 모든 날짜 필터링은 user_id로 제한 [Source: architecture.md#3]

### API Specifications
- **날짜 필터링 API**: `filterNotesByDateRange(startDate: Date, endDate: Date, searchQuery?: string, tags?: string[])` 함수
- **날짜 통계 API**: `getDateRangeStats(startDate: Date, endDate: Date)` - 날짜 범위별 노트 개수 조회
- **권한 제어**: Supabase Auth를 통한 사용자 인증 확인 [Source: architecture.md#3]

### Component Specifications
- **날짜 선택**: shadcn/ui DatePicker 컴포넌트 사용 [Source: architecture.md#1]
- **미리 정의된 옵션**: shadcn/ui Select 컴포넌트 사용
- **선택된 범위 표시**: shadcn/ui Badge 컴포넌트로 표시
- **스타일링**: Tailwind CSS 사용 [Source: architecture.md#1]

### File Locations
- **서버 액션**: `app/actions/notes.ts`에 날짜 필터링 함수 추가
- **날짜 컴포넌트**: `components/notes/date-filter.tsx` 생성
- **날짜 훅**: `hooks/use-date-filter.ts` 생성
- **테스트**: `__tests__/app/actions/notes.test.ts`에 날짜 필터링 테스트 추가

### Testing Requirements
- **단위 테스트**: Vitest 프레임워크 사용
- **테스트 범위**: 날짜 필터링 API, 날짜 선택 UI, 다중 필터 조합
- **통합 테스트**: 날짜 필터와 검색어, 태그 필터 조합 동작 검증

### Technical Constraints
- **ORM**: Drizzle ORM 사용 필수 [Source: architecture.md#1]
- **데이터베이스**: Supabase Postgres [Source: architecture.md#1]
- **날짜 처리**: JavaScript Date 객체와 PostgreSQL TIMESTAMP 호환성 고려
- **쿼리 최적화**: 날짜 범위 쿼리 인덱스 활용

## Testing

### Testing Standards
- **프레임워크**: Vitest 사용
- **테스트 파일 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 패턴**: Given-When-Then 구조

### Specific Testing Requirements
- 단일 날짜 범위 필터링 동작 테스트
- 미리 정의된 날짜 범위 옵션 테스트
- 날짜 필터와 검색어, 태그 필터 조합 테스트
- 날짜 선택 UI 인터랙션 테스트
- 날짜 범위 초기화 기능 테스트
- 날짜 범위별 노트 개수 표시 정확성 테스트
- 날짜 경계값 테스트 (자정, 월말 등)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- 날짜 범위 필터링 API 구현 완료
- 날짜 선택 UI 컴포넌트 구현 완료
- 통합 검색 훅에 날짜 필터링 기능 통합 완료
- 포괄적인 테스트 커버리지 구현 완료

### Completion Notes List
- `filterNotesByDateRange` 서버 액션 구현: 날짜 범위, 검색어, 태그 조합 필터링 지원
- `getDateRangeStats` 서버 액션 구현: 날짜 범위별 노트 개수 통계 제공
- `useDateFilter` 훅 구현: 날짜 필터 상태 관리 및 미리 정의된 범위 지원
- `DateFilter` 컴포넌트 구현: 날짜 선택 UI 및 통계 표시 기능
- `useIntegratedSearch` 훅 확장: 날짜 필터링 기능 통합
- `IntegratedSearch` 컴포넌트 확장: 날짜 필터 UI 통합
- 포괄적인 테스트 구현: API, 훅, 컴포넌트 테스트 완료

### File List
- `app/actions/notes.ts` - 날짜 필터링 서버 액션 추가
- `hooks/use-date-filter.ts` - 날짜 필터 상태 관리 훅 생성
- `components/notes/date-filter.tsx` - 날짜 필터 UI 컴포넌트 생성
- `hooks/use-integrated-search.ts` - 날짜 필터링 기능 통합
- `components/notes/integrated-search.tsx` - 날짜 필터 UI 통합
- `__tests__/app/actions/notes.test.ts` - 날짜 필터링 API 테스트 추가
- `__tests__/hooks/use-date-filter.test.ts` - 날짜 필터 훅 테스트 생성
- `__tests__/components/notes/date-filter.test.tsx` - 날짜 필터 컴포넌트 테스트 생성
- `__tests__/hooks/use-integrated-search.test.ts` - 통합 검색 훅 날짜 필터링 테스트 추가
- `__tests__/components/notes/integrated-search.test.tsx` - 통합 검색 컴포넌트 날짜 필터링 테스트 추가

## QA Results
*이 섹션은 QA 에이전트가 검토 후 채워집니다*
