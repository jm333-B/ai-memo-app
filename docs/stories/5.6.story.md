# Story 5.6: 실시간 검색 제안 (Debounced)

## Status
Done

## Story
**As a** 사용자,
**I want** 검색어를 입력하는 동안 실시간으로 검색 제안을 받을 수 있는 기능,
**so that** 빠르고 효율적으로 원하는 노트를 찾을 수 있다

## Acceptance Criteria
1. 사용자가 검색어를 입력하면 300ms 후에 자동으로 검색이 실행된다
2. 검색어 입력 중에는 이전 검색 요청이 취소되고 새로운 요청만 처리된다
3. 검색 제안은 최대 10개까지 표시된다
4. 검색 제안은 제목과 내용의 일부를 미리보기로 보여준다
5. 검색어가 2글자 미만일 때는 검색 제안을 표시하지 않는다
6. 검색 제안 클릭 시 해당 노트로 바로 이동한다

## Tasks / Subtasks
- [x] Task 1: 디바운싱 검색 훅 구현 (AC: 1, 2, 5)
  - [x] Subtask 1.1: useDebounce 훅 구현 또는 기존 훅 활용
  - [x] Subtask 1.2: 검색 요청 취소 로직 구현 (AbortController)
  - [x] Subtask 1.3: 최소 검색어 길이 검증 로직 구현
  - [x] Subtask 1.4: 검색 상태 관리 (로딩, 에러, 결과)
- [x] Task 2: 검색 제안 API 구현 (AC: 3, 4)
  - [x] Subtask 2.1: `getSearchSuggestions` 서버 액션 생성
  - [x] Subtask 2.2: 검색 제안 결과 제한 및 정렬 로직 구현
  - [x] Subtask 2.3: 제목과 내용 미리보기 생성 로직 구현
  - [x] Subtask 2.4: 사용자 스코프 필터링 적용
- [x] Task 3: 검색 제안 UI 구현 (AC: 4, 6)
  - [x] Subtask 3.1: 검색 제안 드롭다운 컴포넌트 생성
  - [x] Subtask 3.2: 검색 제안 아이템 컴포넌트 생성
  - [x] Subtask 3.3: 키보드 네비게이션 지원 (화살표 키, Enter)
  - [x] Subtask 3.4: 검색 제안 클릭 시 노트 페이지 이동
- [x] Task 4: 테스트 구현
  - [x] Subtask 4.1: 디바운싱 로직 테스트
  - [x] Subtask 4.2: 검색 제안 API 테스트
  - [x] Subtask 4.3: 검색 제안 UI 테스트

## Dev Notes

### Previous Story Insights
- Story 5.1에서 기본 검색 API가 구현되어 있어 검색 제안 API 기반으로 활용
- 기존 useDebounce 훅이 있다면 재사용 가능 (hooks/use-debounce.ts 확인 필요)

### Data Models
- **검색 제안**: id, title, contentPreview, relevanceScore
- **디바운싱 상태**: debouncedQuery: string, isSearching: boolean
- **검색 제안 상태**: suggestions: SearchSuggestion[], selectedIndex: number
- **사용자 스코프**: 모든 검색 제안은 user_id로 제한 [Source: architecture.md#3]

### API Specifications
- **검색 제안 API**: `getSearchSuggestions(query: string, limit: number = 10)` 함수
- **요청 취소**: AbortController를 사용한 이전 요청 취소
- **응답 형식**: 검색 제안 배열과 메타데이터
- **권한 제어**: Supabase Auth를 통한 사용자 인증 확인 [Source: architecture.md#3]

### Component Specifications
- **검색 제안 드롭다운**: shadcn/ui DropdownMenu 컴포넌트 사용 [Source: architecture.md#1]
- **검색 제안 아이템**: 커스텀 컴포넌트로 제목과 미리보기 표시
- **키보드 네비게이션**: onKeyDown 이벤트 핸들러 구현
- **스타일링**: Tailwind CSS 사용 [Source: architecture.md#1]

### File Locations
- **서버 액션**: `app/actions/notes.ts`에 검색 제안 함수 추가
- **검색 제안 컴포넌트**: `components/notes/search-suggestions.tsx` 생성
- **검색 제안 훅**: `hooks/use-search-suggestions.ts` 생성
- **테스트**: `__tests__/hooks/use-search-suggestions.test.ts` 생성

### Testing Requirements
- **단위 테스트**: Vitest 프레임워크 사용
- **테스트 범위**: 디바운싱 로직, 검색 제안 API, UI 인터랙션
- **통합 테스트**: 검색 제안과 노트 페이지 이동 통합 동작 검증

### Technical Constraints
- **성능**: 디바운싱으로 API 호출 최적화 (300ms 지연)
- **사용자 경험**: 검색어 입력 중 로딩 상태 표시
- **접근성**: 키보드 네비게이션 지원 필수
- **브라우저 호환성**: AbortController 지원 브라우저에서 동작

## Testing

### Testing Standards
- **프레임워크**: Vitest 사용
- **테스트 파일 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 패턴**: Given-When-Then 구조

### Specific Testing Requirements
- 디바운싱 지연 시간 테스트 (300ms)
- 검색 요청 취소 로직 테스트
- 최소 검색어 길이 검증 테스트 (2글자)
- 검색 제안 결과 제한 테스트 (최대 10개)
- 키보드 네비게이션 테스트 (화살표 키, Enter)
- 검색 제안 클릭 시 페이지 이동 테스트
- 빈 검색어 처리 테스트
- 검색 제안 로딩 상태 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- 실시간 검색 제안 API 구현 완료
- 디바운싱 및 요청 취소 로직 구현 완료
- 검색 제안 UI 컴포넌트 구현 완료
- 키보드 네비게이션 및 접근성 지원 완료
- 포괄적인 테스트 커버리지 구현 완료

### Completion Notes List
- `getSearchSuggestions` 서버 액션 구현: 관련도 점수 계산 및 정렬 로직 포함
- `useSearchSuggestions` 훅 구현: 디바운싱, AbortController, 상태 관리 기능
- `SearchSuggestions` 컴포넌트 구현: 드롭다운 UI, 키보드 네비게이션, 클릭 이벤트 처리
- `SearchInput` 컴포넌트 확장: 검색 제안 기능 통합, 포커스 관리, 외부 클릭 감지
- 기존 `useDebounce` 훅 활용: 300ms 디바운스 지연 시간 적용
- 포괄적인 테스트 구현: API, 훅, 컴포넌트 테스트 완료

### File List
- `app/actions/notes.ts` - 검색 제안 서버 액션 추가
- `hooks/use-search-suggestions.ts` - 검색 제안 상태 관리 훅 생성
- `components/notes/search-suggestions.tsx` - 검색 제안 드롭다운 컴포넌트 생성
- `components/notes/search-input.tsx` - 검색 제안 기능 통합
- `__tests__/app/actions/notes.test.ts` - 검색 제안 API 테스트 추가
- `__tests__/hooks/use-search-suggestions.test.ts` - 검색 제안 훅 테스트 생성
- `__tests__/components/notes/search-suggestions.test.tsx` - 검색 제안 컴포넌트 테스트 생성

## QA Results
*이 섹션은 QA 에이전트가 검토 후 채워집니다*
