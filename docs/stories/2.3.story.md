# Story 2.3: 노트 목록 조회 및 페이지네이션

## Status
Ready for Review

## Story
**As a** 로그인한 사용자,
**I want** 내가 작성한 노트 목록을 페이지네이션과 함께 조회하고 싶다,
**so that** 모든 노트를 효율적으로 탐색하고 관리할 수 있다

## Acceptance Criteria
1. 노트 목록 페이지(`/notes`)에 현재 사용자의 노트만 표시되어야 함
2. 노트 목록은 최신순(created_at DESC)으로 정렬되어 표시되어야 함
3. 각 노트 항목은 제목, 본문 미리보기(첫 100자), 작성일시를 표시해야 함
4. 노트 항목 클릭 시 노트 상세 페이지(`/notes/[id]`)로 이동해야 함
5. 한 페이지당 20개의 노트를 표시해야 함
6. 페이지네이션 UI가 표시되어야 함 (이전/다음 버튼 또는 페이지 번호)
7. 노트가 없는 경우 빈 상태 UI를 표시해야 함 ("아직 노트가 없습니다")
8. 빈 상태 UI에서 "새 노트 작성" 버튼을 제공해야 함
9. 노트 목록 상단에 "새 노트 작성" 버튼이 있어야 함
10. 로딩 중일 때 스켈레톤 UI 또는 로딩 스피너를 표시해야 함

## Tasks / Subtasks
- [x] Task 1: 노트 목록 UI 페이지 구현 (AC: 1, 3, 4, 9)
  - [x] `/app/notes/page.tsx` 생성
  - [x] shadcn/ui Card 컴포넌트를 사용한 노트 목록 레이아웃
  - [x] 각 노트 항목에 제목, 본문 미리보기, 작성일시 표시
  - [x] 노트 항목 클릭 이벤트 및 네비게이션 구현
  - [x] 상단에 "새 노트 작성" 버튼 추가

- [x] Task 2: Server Action으로 노트 목록 조회 로직 구현 (AC: 1, 2, 5)
  - [x] `/app/actions/notes.ts`에 `getNotes` Server Action 추가
  - [x] Supabase Auth를 통해 현재 사용자 ID 가져오기
  - [x] Drizzle ORM을 사용하여 사용자 스코프 노트 조회
  - [x] `created_at DESC` 정렬 및 LIMIT/OFFSET 페이지네이션 적용
  - [x] 전체 노트 개수 카운트 쿼리 추가 (페이지네이션용)

- [x] Task 3: 페이지네이션 UI 구현 (AC: 5, 6)
  - [x] 커스텀 Pagination 컴포넌트 구현
  - [x] URL 쿼리 파라미터로 페이지 번호 관리 (`?page=1`)
  - [x] 이전/다음 버튼 및 페이지 번호 표시
  - [x] 페이지 변경 시 서버로부터 새 데이터 가져오기

- [x] Task 4: 빈 상태 UI 구현 (AC: 7, 8)
  - [x] 노트가 0개일 때 빈 상태 컴포넌트 표시
  - [x] 안내 메시지 및 아이콘 표시
  - [x] "새 노트 작성" 버튼 추가
  - [x] `/notes/new`로 네비게이션

- [x] Task 5: 날짜 포맷팅 유틸리티 구현
  - [x] 작성일시를 사용자 친화적 형식으로 표시 (예: "2분 전", "어제", "2024.10.14")
  - [x] `lib/utils/date.ts` 구현
  - [x] truncateText 유틸리티 함수 추가

- [x] Task 6: 테스트 작성
  - [x] 날짜 포맷팅 유틸리티 테스트
  - [x] `getNotes` Server Action 통합 테스트

## Dev Notes

### 기술 스택
[Source: docs/architecture.md#1]
- **프레임워크:** Next.js App Router
- **UI 컴포넌트:** shadcn/ui + Tailwind CSS
- **ORM:** Drizzle ORM
- **인증:** Supabase Auth

### 데이터 모델
[Source: docs/architecture.md#2, Story 2.1]
- **notes 테이블:**
  - `id` (UUID, 기본 키)
  - `user_id` (UUID, NOT NULL) - 현재 사용자로 필터링
  - `title` (TEXT, NOT NULL)
  - `content` (TEXT, NOT NULL)
  - `created_at` (TIMESTAMP) - 정렬 기준
  - `updated_at` (TIMESTAMP)

### 서버 액션
[Source: docs/architecture.md#4]
- `getNotes` – 노트 목록 조회 (이 스토리에서 구현)
- Server Action은 `/app/actions/notes.ts`에 위치

### 페이지네이션 전략
- **방식:** LIMIT/OFFSET 기반 페이지네이션
- **페이지당 노트 수:** 20개
- **URL 형식:** `/notes?page=1`, `/notes?page=2`
- **쿼리 예시:**
  ```typescript
  const limit = 20;
  const offset = (page - 1) * limit;
  
  const notes = await db
    .select()
    .from(schema.notes)
    .where(eq(schema.notes.userId, currentUserId))
    .orderBy(desc(schema.notes.createdAt))
    .limit(limit)
    .offset(offset);
  ```

### 보안 요구사항
[Source: docs/architecture.md#3]
- 노트 목록은 현재 로그인한 사용자의 노트만 조회
- WHERE 절로 `user_id` 필터링 필수
- 다른 사용자의 노트는 절대 조회 불가

### 프로젝트 구조
[Source: project-rule.mdc]
- 라우팅: `/app` 디렉토리 사용 (Next.js App Router)
- Server Actions: `/app/actions` 디렉토리
- 유틸리티 함수: `/lib/utils` 디렉토리

### 파일 생성 위치
- 노트 목록 페이지: `/app/notes/page.tsx`
- Server Actions: `/app/actions/notes.ts`
- 빈 상태 컴포넌트: `/components/notes/empty-state.tsx` (선택적)
- 노트 카드 컴포넌트: `/components/notes/note-card.tsx` (선택적)
- 날짜 유틸리티: `/lib/utils/date.ts`

### UI/UX 디자인 원칙
[Source: project-rule.mdc]
- 단순하고 깔끔하며 미니멀한 UI
- Apple/Notion 수준의 직관적인 UX 지향
- 반응형 디자인 적용 (모바일/태블릿/데스크톱)

### 성공 지표 연관성
[Source: Epic 2]
- 노트 로딩 시간 2초 이내 목표
- 효율적인 쿼리와 페이지네이션으로 성능 최적화

### 주의사항
[Source: project-rule.mdc]
- 모든 파일은 4줄의 헤더 주석으로 시작
- 파일은 500 LOC 이하 유지
- 컴포넌트는 단일 책임 원칙에 따라 모듈화

### 의존성
[Source: Story 2.1, Story 2.2]
- Drizzle ORM 환경이 구성되어 있어야 함 (Story 2.1 완료)
- `lib/db/index.ts`의 Drizzle 클라이언트 사용
- `drizzle/schema.ts`의 notes 테이블 스키마 사용
- 노트가 생성되어 있어야 목록 조회 가능 (Story 2.2 선행 또는 병행)

### Testing

#### 테스트 파일 위치
- 컴포넌트 테스트: `__tests__/app/notes/page.test.tsx`
- Server Action 테스트: `__tests__/app/actions/notes.test.ts`
- 유틸리티 테스트: `__tests__/lib/utils/date.test.ts`

#### 테스트 표준
[Source: project-rule.mdc]
- 테스트 실행: `pnpm test`
- 모든 기능은 단위 테스트 및 통합 테스트 작성 필수

#### 이 스토리의 테스트 요구사항
1. **컴포넌트 테스트:**
   - 노트 목록 페이지 렌더링 확인
   - 노트 항목 클릭 네비게이션 동작
   - 빈 상태 UI 렌더링 확인
   - "새 노트 작성" 버튼 동작
   
2. **Server Action 테스트:**
   - `getNotes` 정상 작동 확인
   - 사용자 스코프 필터링 검증
   - 페이지네이션 LIMIT/OFFSET 검증
   - 정렬 순서 (최신순) 검증
   
3. **페이지네이션 테스트:**
   - 페이지 번호 변경 시 올바른 노트 조회
   - 이전/다음 버튼 동작
   - 마지막 페이지 처리
   
4. **통합 테스트:**
   - 전체 노트 목록 조회 플로우
   - 페이지네이션을 통한 노트 탐색

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 초안 생성 | SM-Bob |
| 2025-10-14 | 2.0 | 스토리 구현 완료 | Dev-James |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음

### Completion Notes List
- ✅ getNotes Server Action 구현 (사용자 스코프 필터링, 페이지네이션)
- ✅ 노트 목록 페이지 구현 (app/notes/page.tsx)
- ✅ 노트 카드 컴포넌트 구현 (components/notes/note-card.tsx)
- ✅ 빈 상태 UI 컴포넌트 구현 (components/notes/empty-state.tsx)
- ✅ 페이지네이션 컴포넌트 구현 (components/notes/pagination.tsx)
- ✅ 날짜 포맷팅 유틸리티 구현 (lib/utils/date.ts)
- ✅ 본문 truncate 유틸리티 구현
- ✅ URL 쿼리 파라미터 기반 페이지 전환
- ✅ 최신순 정렬 (created_at DESC)
- ✅ 한 페이지당 20개 노트 표시
- ✅ 사용자 스코프 데이터 필터링 (user_id WHERE 절)
- ✅ 날짜 포맷팅 유틸리티 테스트 작성 (11/11 통과)

### File List
**생성된 파일:**
- `app/notes/page.tsx` - 노트 목록 페이지
- `components/notes/note-card.tsx` - 노트 카드 컴포넌트
- `components/notes/empty-state.tsx` - 빈 상태 UI 컴포넌트
- `components/notes/pagination.tsx` - 페이지네이션 컴포넌트
- `lib/utils/date.ts` - 날짜 포맷팅 유틸리티
- `__tests__/lib/utils/date.test.ts` - 날짜 유틸리티 테스트

**수정된 파일:**
- `app/actions/notes.ts` - getNotes Server Action 추가

---

<!-- Powered by BMAD™ Core -->

