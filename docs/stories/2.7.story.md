# Story 2.7: 노트 정렬 옵션

## Status
Draft

## Story
**As a** 로그인한 사용자,
**I want** 노트 목록을 다양한 기준(최신순, 제목순)으로 정렬할 수 있다,
**so that** 원하는 노트를 더 빠르게 찾고 효율적으로 관리할 수 있다

## Acceptance Criteria
1. 노트 목록 페이지 상단에 정렬 옵션 드롭다운이 표시되어야 함
2. 정렬 옵션은 다음을 포함해야 함:
   - 최신순 (기본값) - `created_at DESC`
   - 오래된순 - `created_at ASC`
   - 제목순 (가나다순) - `title ASC`
   - 제목 역순 - `title DESC`
3. 정렬 옵션을 변경하면 즉시 노트 목록이 재정렬되어야 함
4. 선택한 정렬 옵션은 URL 쿼리 파라미터로 유지되어야 함 (`?sort=latest`, `?sort=title-asc`)
5. 페이지를 새로고침해도 선택한 정렬 옵션이 유지되어야 함
6. 정렬 변경 시 현재 페이지 번호는 1로 리셋되어야 함
7. 정렬 옵션은 모든 기기에서 반응형으로 작동해야 함
8. 정렬 중 로딩 상태를 표시해야 함
9. 빈 목록(노트 0개)일 때도 정렬 드롭다운은 표시되어야 함 (비활성화)

## Tasks / Subtasks
- [ ] Task 1: 정렬 옵션 UI 컴포넌트 구현 (AC: 1, 2, 7)
  - [ ] `/components/notes/sort-dropdown.tsx` 생성
  - [ ] shadcn/ui Select 컴포넌트 사용
  - [ ] 정렬 옵션 4가지 표시
  - [ ] 현재 선택된 옵션 하이라이트
  - [ ] 반응형 디자인 (모바일/데스크톱)

- [ ] Task 2: URL 쿼리 파라미터 처리 (AC: 4, 5, 6)
  - [ ] `useSearchParams`, `useRouter` 활용
  - [ ] 정렬 옵션 변경 시 URL 업데이트
  - [ ] 페이지 번호 리셋 로직
  - [ ] 쿼리 파라미터 기본값 처리 (`sort=latest`)

- [ ] Task 3: Server Action 정렬 로직 수정 (AC: 3)
  - [ ] `/app/actions/notes.ts`의 `getNotes` 함수 수정
  - [ ] `sortBy` 파라미터 추가
  - [ ] Drizzle ORM `orderBy` 동적 처리
  - [ ] 유효하지 않은 정렬 옵션 방어 로직

- [ ] Task 4: 노트 목록 페이지에 정렬 통합 (AC: 3, 8, 9)
  - [ ] `/app/notes/page.tsx` 수정
  - [ ] 정렬 드롭다운 컴포넌트 추가
  - [ ] 정렬 옵션에 따라 Server Action 호출
  - [ ] 로딩 상태 처리
  - [ ] 빈 목록일 때 드롭다운 비활성화

- [ ] Task 5: 테스트 작성
  - [ ] 정렬 드롭다운 컴포넌트 테스트
  - [ ] URL 쿼리 파라미터 업데이트 테스트
  - [ ] `getNotes` 정렬 로직 단위 테스트
  - [ ] 정렬 변경 통합 테스트

## Dev Notes

### 기술 스택
[Source: docs/architecture.md#1]
- **프레임워크:** Next.js App Router (URL 쿼리 파라미터)
- **UI 컴포넌트:** shadcn/ui Select + Tailwind CSS
- **ORM:** Drizzle ORM (`orderBy` 동적 처리)
- **상태 관리:** URL 쿼리 파라미터 (Server-driven)

### 데이터 모델
[Source: docs/architecture.md#2, Story 2.1]
- **notes 테이블:**
  - `created_at` (TIMESTAMP) - 최신순/오래된순 정렬 기준
  - `title` (TEXT) - 제목순 정렬 기준

### 정렬 옵션 매핑
```typescript
const SORT_OPTIONS = {
  latest: { column: 'createdAt', order: 'desc' },
  oldest: { column: 'createdAt', order: 'asc' },
  'title-asc': { column: 'title', order: 'asc' },
  'title-desc': { column: 'title', order: 'desc' },
};
```

### URL 쿼리 파라미터 구조
- `/notes?sort=latest` - 최신순 (기본값)
- `/notes?sort=oldest` - 오래된순
- `/notes?sort=title-asc` - 제목순
- `/notes?sort=title-desc` - 제목 역순
- `/notes?sort=latest&page=2` - 정렬과 페이지네이션 조합

### Server Action 수정 사항
[Source: Story 2.3]
- 기존 `getNotes(page, limit)` 함수 시그니처 수정
- 새로운 시그니처: `getNotes(page, limit, sortBy)`
- Drizzle `orderBy` 동적 처리:
  ```typescript
  const orderByClause = sortBy === 'title-asc' 
    ? asc(schema.notes.title)
    : desc(schema.notes.createdAt);
  ```

### 프로젝트 구조
[Source: project-rule.mdc]
- 정렬 드롭다운 컴포넌트: `/components/notes/sort-dropdown.tsx`
- Server Actions 수정: `/app/actions/notes.ts` (기존 파일)
- 노트 목록 페이지 수정: `/app/notes/page.tsx` (기존 파일)

### UI/UX 디자인 원칙
[Source: project-rule.mdc]
- shadcn/ui Select 컴포넌트 사용
- 드롭다운 아이콘: 정렬 아이콘 (↕️ 또는 lucide-react ArrowUpDown)
- 선택된 옵션은 체크마크로 표시
- 모바일에서는 전체 너비, 데스크톱에서는 고정 너비

### 주의사항
[Source: project-rule.mdc]
- 모든 파일은 4줄의 헤더 주석으로 시작
- 파일은 500 LOC 이하 유지
- 정렬 옵션 변경 시 페이지는 1로 리셋 (사용자 혼란 방지)

### 의존성
[Source: Story 2.3]
- 노트 목록 조회 기능이 구현되어 있어야 함 (Story 2.3 완료)
- `getNotes` Server Action이 존재해야 함
- 페이지네이션 기능이 작동해야 함

### 선택적 개선사항
- 정렬 옵션을 localStorage에 저장 (다음 방문 시 유지)
- 정렬 변경 시 부드러운 애니메이션
- 키보드 단축키 (Ctrl+S: 정렬 변경)

### Testing

#### 테스트 파일 위치
- 정렬 드롭다운 테스트: `__tests__/components/notes/sort-dropdown.test.tsx`
- Server Action 테스트: `__tests__/app/actions/notes.test.ts` (기존 파일에 추가)
- 통합 테스트: `__tests__/app/notes/page.test.tsx` (기존 파일에 추가)

#### 테스트 표준
[Source: project-rule.mdc]
- 테스트 실행: `pnpm test`
- 모든 기능은 단위 테스트 및 통합 테스트 작성 필수

#### 이 스토리의 테스트 요구사항
1. **컴포넌트 테스트:**
   - 정렬 드롭다운 렌더링 확인
   - 모든 정렬 옵션 표시 확인
   - 옵션 선택 시 URL 업데이트 확인
   
2. **Server Action 테스트:**
   - 각 정렬 옵션별로 올바른 순서로 노트 반환 확인
   - 유효하지 않은 정렬 옵션 처리 확인
   
3. **통합 테스트:**
   - 정렬 옵션 변경 → 노트 목록 재정렬 확인
   - 페이지 새로고침 시 정렬 유지 확인
   - 정렬 변경 시 페이지 1로 리셋 확인

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 초안 생성 | SM-Bob |

## Dev Agent Record

### Agent Model Used
_개발 시 자동 기록_

### Debug Log References
_개발 시 자동 기록_

### Completion Notes List
_개발 시 자동 기록_

### File List
_개발 시 자동 기록_

---

<!-- Powered by BMAD™ Core -->

