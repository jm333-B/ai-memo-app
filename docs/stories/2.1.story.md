# Story 2.1: Drizzle ORM í™˜ê²½ ì„¸íŒ… ë° Notes ìŠ¤í‚¤ë§ˆ êµ¬ì„±

## Status
Ready for Review

## Story
**As a** ê°œë°œì,
**I want** Drizzle ORMì„ í”„ë¡œì íŠ¸ì— ì„¤ì •í•˜ê³  ë…¸íŠ¸ ê´€ë¦¬ë¥¼ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ êµ¬ì„±í•˜ê³  ì‹¶ë‹¤,
**so that** ì•ˆì •ì ì´ê³  íƒ€ì… ì•ˆì „í•œ ë°©ì‹ìœ¼ë¡œ ë…¸íŠ¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

## Acceptance Criteria
1. Drizzle ORM ë° ê´€ë ¨ íŒ¨í‚¤ì§€ê°€ í”„ë¡œì íŠ¸ì— ì„¤ì¹˜ë˜ì–´ì•¼ í•¨
2. Drizzle ì„¤ì • íŒŒì¼(`drizzle.config.ts`)ì´ Supabase Postgres ì—°ê²°ì„ ìœ„í•´ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì–´ì•¼ í•¨
3. `notes` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆê°€ `/drizzle/schema.ts`ì— ì •ì˜ë˜ì–´ì•¼ í•¨ (id, user_id, title, content, created_at, updated_at)
4. Drizzle Kitì„ í†µí•œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ìƒì„±ë˜ì–´ì•¼ í•¨
5. ë§ˆì´ê·¸ë ˆì´ì…˜ì´ Supabase ë°ì´í„°ë² ì´ìŠ¤ì— ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì–´ì•¼ í•¨
6. Drizzle í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³  ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ì•¼ í•¨
7. `package.json`ì— Drizzle ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ê°€ ì¶”ê°€ë˜ì–´ì•¼ í•¨ (generate, migrate, push, studio)
8. ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‚¬í•­ì´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íƒ€ì…ìœ¼ë¡œ ìë™ ë°˜ì˜ë˜ì–´ì•¼ í•¨

## Tasks / Subtasks
- [x] Task 1: Drizzle ORM íŒ¨í‚¤ì§€ ì„¤ì¹˜ (AC: 1)
  - [x] `drizzle-orm`, `drizzle-kit` ì„¤ì¹˜
  - [x] Postgres ë“œë¼ì´ë²„ ì„¤ì¹˜ (`postgres` ë˜ëŠ” `@supabase/supabase-js`)
  - [x] íƒ€ì… ì •ì˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (í•„ìš” ì‹œ)
  
- [x] Task 2: Drizzle ì„¤ì • íŒŒì¼ êµ¬ì„± (AC: 2, 7)
  - [x] `drizzle.config.ts` ìƒì„± ë° Supabase ì—°ê²° ë¬¸ìì—´ ì„¤ì •
  - [x] ìŠ¤í‚¤ë§ˆ íŒŒì¼ ê²½ë¡œ ì„¤ì • (`/drizzle/schema.ts`)
  - [x] ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶œë ¥ ë””ë ‰í† ë¦¬ ì„¤ì • (`/drizzle/migrations`)
  - [x] `package.json`ì— Drizzle Kit ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
  
- [x] Task 3: Notes í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ (AC: 3, 8)
  - [x] `/drizzle/schema.ts` íŒŒì¼ ìƒì„±
  - [x] `notes` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜:
    - `id` (UUID, ê¸°ë³¸ í‚¤, ìë™ ìƒì„±)
    - `user_id` (UUID, ì™¸ë˜ í‚¤, NOT NULL)
    - `title` (TEXT, NOT NULL)
    - `content` (TEXT, NOT NULL)
    - `created_at` (TIMESTAMP, ê¸°ë³¸ê°’: now())
    - `updated_at` (TIMESTAMP, ê¸°ë³¸ê°’: now())
  - [x] ì¸ë±ìŠ¤ ì •ì˜ (user_id, created_at)
  
- [x] Task 4: ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš© (AC: 4, 5)
  - [x] `pnpm drizzle-kit:generate` ì‹¤í–‰í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
  - [x] ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ê²€í† 
  - [x] `pnpm drizzle-kit:push` ë˜ëŠ” `migrate` ì‹¤í–‰í•˜ì—¬ DBì— ì ìš©
  - [x] Supabase Studioì—ì„œ í…Œì´ë¸” ìƒì„± í™•ì¸
  
- [x] Task 5: Drizzle í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (AC: 6)
  - [x] `/lib/db/index.ts` ë˜ëŠ” `/lib/drizzle.ts` ìƒì„±
  - [x] Supabase ì—°ê²°ì„ ì‚¬ìš©í•˜ëŠ” Drizzle í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
  - [x] ìŠ¤í‚¤ë§ˆ import ë° íƒ€ì… export
  
- [x] Task 6: í…ŒìŠ¤íŠ¸ ì‘ì„±
  - [x] Drizzle í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸
  - [x] ìŠ¤í‚¤ë§ˆ íƒ€ì… ê²€ì¦ í…ŒìŠ¤íŠ¸
  - [x] ê¸°ë³¸ CRUD ì‘ë™ í™•ì¸ í…ŒìŠ¤íŠ¸

## Dev Notes

### ê¸°ìˆ  ìŠ¤íƒ
[Source: docs/architecture.md#1]
- **ORM:** Drizzle ORM
- **ë°ì´í„°ë² ì´ìŠ¤:** Supabase Postgres
- **í”„ë ˆì„ì›Œí¬:** Next.js App Router

### ë°ì´í„° ëª¨ë¸
[Source: docs/architecture.md#2]
- **notes í…Œì´ë¸”:**
  - id, user_id, title, content, created_at, updated_at
- ëª¨ë“  í…Œì´ë¸”ì€ `/drizzle/schema.ts`ì˜ Drizzle Schemaë¡œ ì •ì˜
- ë§ˆì´ê·¸ë ˆì´ì…˜ì€ Drizzle Kitìœ¼ë¡œ ì‹¤í–‰

### ë³´ì•ˆ ìš”êµ¬ì‚¬í•­
[Source: docs/architecture.md#3]
- ê¶Œí•œ ìŠ¤ì½”í”„ëŠ” ì„œë²„ ì½”ë“œì—ì„œ ì²˜ë¦¬
- ëª¨ë“  Drizzle ì¿¼ë¦¬ëŠ” ì‚¬ìš©ì ìŠ¤ì½”í”„ë¥¼ WHEREë¡œ ì§ì ‘ ê°•ì œ
- `user_id`ëŠ” Supabase Authì˜ ì‚¬ìš©ì IDì™€ ì—°ë™

### Drizzle ëª…ë ¹ì–´
[Source: project-rule.mdc]
```bash
pnpm drizzle-kit generate    # ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
pnpm drizzle-kit migrate     # ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
pnpm drizzle-kit push        # ìŠ¤í‚¤ë§ˆ DBì— ë°˜ì˜
pnpm drizzle-kit pull        # DB ìŠ¤í‚¤ë§ˆ ê°€ì ¸ì˜¤ê¸°
pnpm drizzle-kit check       # ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ ê²€ì‚¬
pnpm drizzle-kit studio      # Drizzle Studio ì‹¤í–‰
```

### í™˜ê²½ ë³€ìˆ˜
Supabase ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìœ„í•œ í™˜ê²½ ë³€ìˆ˜:
```
DATABASE_URL=postgresql://[user]:[password]@[host]:[port]/[database]
```
ë˜ëŠ” Supabase ì—°ê²° í’€ë§ URL ì‚¬ìš©

### íŒŒì¼ ìƒì„± ìœ„ì¹˜
- Drizzle ì„¤ì •: `/drizzle.config.ts`
- ìŠ¤í‚¤ë§ˆ ì •ì˜: `/drizzle/schema.ts`
- ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼: `/drizzle/migrations/`
- Drizzle í´ë¼ì´ì–¸íŠ¸: `/lib/db/index.ts` ë˜ëŠ” `/lib/drizzle.ts`

### ì£¼ì˜ì‚¬í•­
[Source: project-rule.mdc]
- ëª¨ë“  íŒŒì¼ì€ 4ì¤„ì˜ í—¤ë” ì£¼ì„ìœ¼ë¡œ ì‹œì‘
- íŒŒì¼ì€ 500 LOC ì´í•˜ ìœ ì§€
- DB ê´€ë ¨ ì œì•ˆì€ ê°€ëŠ¥í•˜ë˜ ì§ì ‘ ì‹¤í–‰ì€ ì‚¬ìš©ìê°€ ìˆ˜í–‰

### Testing

#### í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜
- Drizzle í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸: `__tests__/lib/db/` ë˜ëŠ” `__tests__/lib/drizzle.test.ts`
- ìŠ¤í‚¤ë§ˆ í…ŒìŠ¤íŠ¸: `__tests__/drizzle/schema.test.ts`

#### í…ŒìŠ¤íŠ¸ í‘œì¤€
[Source: project-rule.mdc]
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰: `pnpm test`
- ëª¨ë“  ê¸°ëŠ¥ì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± í•„ìˆ˜

#### ì´ ìŠ¤í† ë¦¬ì˜ í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
1. **ì—°ê²° í…ŒìŠ¤íŠ¸:**
   - Drizzle í´ë¼ì´ì–¸íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ëŠ”ì§€ í™•ì¸
   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ìœ íš¨í•œì§€ í™•ì¸
   
2. **ìŠ¤í‚¤ë§ˆ í…ŒìŠ¤íŠ¸:**
   - Notes í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ íƒ€ì…ì´ ì˜¬ë°”ë¥´ê²Œ ì •ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - í•„ìˆ˜ í•„ë“œê°€ ëª¨ë‘ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
   
3. **ê¸°ë³¸ CRUD í…ŒìŠ¤íŠ¸:**
   - ê°„ë‹¨í•œ ë…¸íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸ (insert)
   - ë…¸íŠ¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸ (select)
   - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | ìŠ¤í† ë¦¬ ì´ˆì•ˆ ìƒì„± | PO-Sarah |
| 2025-10-14 | 1.1 | ìŠ¤í† ë¦¬ êµ¬í˜„ ì§„í–‰ ì¤‘ (Task 4 ì œì™¸ ì™„ë£Œ) | Dev-James |
| 2025-10-14 | 2.0 | ìŠ¤í† ë¦¬ êµ¬í˜„ ì™„ë£Œ | Dev-James |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
ì—†ìŒ

### Completion Notes List
- âœ… Drizzle ORM ë° ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ (drizzle-orm v0.44.6, drizzle-kit v0.31.5, postgres v3.4.7)
- âœ… dotenv íŒ¨í‚¤ì§€ ì¶”ê°€í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ ë¡œë”© ê°œì„ 
- âœ… Drizzle ì„¤ì • íŒŒì¼ ìƒì„± ì™„ë£Œ (drizzle.config.ts with dotenv)
- âœ… package.jsonì— Drizzle Kit ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (generate, migrate, push, pull, check, up, studio)
- âœ… Notes í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ ì™„ë£Œ (id, user_id, title, content, created_at, updated_at)
- âœ… ì¸ë±ìŠ¤ ì„¤ì • ì™„ë£Œ (notes_user_id_idx, notes_created_at_idx)
- âœ… Drizzle í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ (lib/db/index.ts)
- âœ… íƒ€ì… ì•ˆì „ì„± í™•ë³´ë¥¼ ìœ„í•œ íƒ€ì… export ì™„ë£Œ (Note, NewNote)
- âœ… DATABASE_URL í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ (íŠ¹ìˆ˜ë¬¸ì URL ì¸ì½”ë”© ì²˜ë¦¬)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± ì™„ë£Œ (drizzle/migrations/0000_lumpy_punisher.sql)
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì ìš© ì™„ë£Œ (pnpm drizzle-kit:push)
- âœ… Supabase ë°ì´í„°ë² ì´ìŠ¤ì— notes í…Œì´ë¸” ìƒì„± í™•ì¸
- âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì • ì™„ë£Œ (vitest.setup.tsì— dotenv ì¶”ê°€)
- âœ… í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜ì • ì™„ë£Œ (UUID íƒ€ì… ì‚¬ìš©)
- âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (10/10 tests passed)

**ğŸ”§ í•´ê²°í•œ ì´ìŠˆ:**
1. DATABASE_URLì˜ íŠ¹ìˆ˜ë¬¸ì `##` â†’ `%23%23`ë¡œ URL ì¸ì½”ë”© ì²˜ë¦¬
2. Vitest í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ ì„¤ì •
3. í…ŒìŠ¤íŠ¸ì—ì„œ UUID íƒ€ì… ì‚¬ìš© (crypto.randomUUID())

### File List
**ìƒì„±ëœ íŒŒì¼:**
- `drizzle.config.ts` - Drizzle Kit ì„¤ì • íŒŒì¼ (dotenv í¬í•¨)
- `drizzle/schema.ts` - Notes í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜
- `drizzle/migrations/0000_lumpy_punisher.sql` - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼
- `drizzle/migrations/meta/_journal.json` - ë§ˆì´ê·¸ë ˆì´ì…˜ ì €ë„
- `drizzle/migrations/meta/0000_snapshot.json` - ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤ëƒ…ìƒ·
- `lib/db/index.ts` - Drizzle í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤
- `__tests__/lib/db/index.test.ts` - Drizzle í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸
- `__tests__/drizzle/schema.test.ts` - ìŠ¤í‚¤ë§ˆ íƒ€ì… ê²€ì¦ í…ŒìŠ¤íŠ¸

**ìˆ˜ì •ëœ íŒŒì¼:**
- `package.json` - Drizzle ê´€ë ¨ íŒ¨í‚¤ì§€ ë° ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (dotenv, drizzle-orm, drizzle-kit, postgres)
- `.env.local` - DATABASE_URL ì„¤ì • ë° íŠ¹ìˆ˜ë¬¸ì URL ì¸ì½”ë”©
- `vitest.setup.ts` - dotenv ì„¤ì • ì¶”ê°€

---

<!-- Powered by BMADâ„¢ Core -->

