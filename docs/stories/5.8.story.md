# Story 5.8: 검색 로딩 상태 관리

## Status
Done

## Story
**As a** 사용자,
**I want** 검색 중일 때 적절한 로딩 상태를 확인할 수 있는 기능,
**so that** 검색이 진행 중임을 알 수 있고 사용자 경험이 향상된다

## Acceptance Criteria
1. 검색 요청이 시작되면 로딩 상태가 표시된다
2. 검색 중에는 이전 검색 결과가 유지되거나 스켈레톤 UI가 표시된다
3. 검색 완료 시 로딩 상태가 즉시 해제된다
4. 검색 실패 시 에러 상태가 표시되고 재시도 옵션이 제공된다
5. 로딩 상태는 검색어 입력, 필터 변경, 페이지네이션 등 모든 검색 액션에 적용된다
6. 로딩 상태 표시는 성능에 영향을 주지 않는다

## Tasks / Subtasks
- [x] Task 1: 검색 로딩 상태 관리 훅 구현 (AC: 1, 3, 5)
  - [x] Subtask 1.1: useSearchLoading 훅 구현
  - [x] Subtask 1.2: 로딩 상태 전환 로직 구현 (idle, loading, success, error)
  - [x] Subtask 1.3: 검색 액션별 로딩 상태 관리
  - [x] Subtask 1.4: 로딩 상태 지속 시간 최적화
- [x] Task 2: 로딩 UI 컴포넌트 구현 (AC: 2, 6)
  - [x] Subtask 2.1: 검색 로딩 스피너 컴포넌트 생성
  - [x] Subtask 2.2: 검색 결과 스켈레톤 UI 컴포넌트 생성
  - [x] Subtask 2.3: 로딩 상태 오버레이 컴포넌트 생성
  - [x] Subtask 2.4: 성능 최적화 (메모이제이션) 적용
- [x] Task 3: 에러 상태 처리 (AC: 4)
  - [x] Subtask 3.1: 검색 에러 상태 컴포넌트 생성
  - [x] Subtask 3.2: 재시도 기능 구현
  - [x] Subtask 3.3: 에러 메시지 표시 및 사용자 안내
  - [x] Subtask 3.4: 에러 로깅 및 모니터링 연동
- [x] Task 4: 통합 및 테스트 (AC: 1, 2, 3, 4, 5)
  - [x] Subtask 4.1: 모든 검색 컴포넌트에 로딩 상태 통합
  - [x] Subtask 4.2: 로딩 상태 관리 테스트
  - [x] Subtask 4.3: 에러 상태 처리 테스트
  - [x] Subtask 4.4: 성능 테스트

## Dev Notes

### Previous Story Insights
- Story 5.1~5.7에서 모든 검색 기능이 구현되어 있어 로딩 상태 관리가 필요한 모든 지점 파악 가능
- 기존 로딩 컴포넌트나 스켈레톤 UI가 있다면 재사용하여 일관성 유지

### Data Models
- **로딩 상태**: isLoading: boolean, error: string | null, lastSearchTime: number
- **검색 액션 타입**: search, filter, pagination, suggestion
- **에러 상태**: errorType: 'network' | 'server' | 'timeout', retryCount: number
- **성능 메트릭**: searchDuration: number, loadingStartTime: number

### API Specifications
- **로딩 상태 관리**: 클라이언트 사이드에서 처리 (React 상태 관리)
- **에러 처리**: try-catch 블록과 에러 바운더리 활용
- **재시도 로직**: exponential backoff를 사용한 재시도 구현
- **성능 모니터링**: 검색 응답 시간 측정 및 로깅

### Component Specifications
- **로딩 스피너**: shadcn/ui Spinner 또는 커스텀 로딩 컴포넌트 사용 [Source: architecture.md#1]
- **스켈레톤 UI**: shadcn/ui Skeleton 컴포넌트 사용
- **에러 상태**: shadcn/ui Alert 컴포넌트 사용
- **스타일링**: Tailwind CSS 사용 [Source: architecture.md#1]

### File Locations
- **로딩 훅**: `hooks/use-search-loading.ts` 생성
- **로딩 컴포넌트**: `components/ui/search-loading.tsx` 생성
- **스켈레톤 컴포넌트**: `components/ui/search-skeleton.tsx` 생성
- **에러 컴포넌트**: `components/ui/search-error.tsx` 생성
- **테스트**: `__tests__/hooks/use-search-loading.test.ts` 생성

### Testing Requirements
- **단위 테스트**: Vitest 프레임워크 사용
- **테스트 범위**: 로딩 상태 관리, UI 컴포넌트, 에러 처리
- **통합 테스트**: 검색 플로우와 로딩 상태 통합 동작 검증

### Technical Constraints
- **성능**: 로딩 상태 표시로 인한 성능 저하 방지
- **사용자 경험**: 로딩 시간이 길어질 경우 진행률 표시 고려
- **에러 처리**: 네트워크 오류, 서버 오류, 타임아웃 등 다양한 에러 상황 처리
- **접근성**: 스크린 리더 사용자를 위한 로딩 상태 안내

## Testing

### Testing Standards
- **프레임워크**: Vitest 사용
- **테스트 파일 위치**: `__tests__/` 디렉토리 구조 준수
- **테스트 패턴**: Given-When-Then 구조

### Specific Testing Requirements
- 로딩 상태 전환 테스트 (idle → loading → success)
- 검색 액션별 로딩 상태 테스트
- 에러 상태 처리 테스트
- 재시도 기능 테스트
- 로딩 UI 렌더링 테스트
- 스켈레톤 UI 표시 테스트
- 성능 테스트 (로딩 상태로 인한 지연 없음)
- 접근성 테스트 (스크린 리더 호환성)
- 네트워크 오류 시나리오 테스트
- 타임아웃 처리 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- 검색 로딩 상태 관리 훅 구현 완료
- 로딩 UI 컴포넌트 및 스켈레톤 UI 구현 완료
- 에러 상태 처리 및 재시도 로직 구현 완료
- 통합 검색 컴포넌트에 로딩 상태 통합 완료
- 노트 목록 페이지에 로딩 상태 적용 완료
- 포괄적인 테스트 커버리지 구현 완료

### Completion Notes List
- `useSearchLoading` 훅 구현: 로딩 상태 전환, 에러 처리, 재시도 로직 (exponential backoff)
- `SearchLoadingSpinner` 컴포넌트 구현: 액션 타입별 로딩 텍스트 표시
- `SearchSkeleton` 컴포넌트 구현: list, card, inline 타입 스켈레톤 UI
- `SearchError` 컴포넌트 구현: 에러 타입별 메시지, 재시도 버튼, 최대 재시도 횟수 관리
- `SearchLoadingOverlay` 컴포넌트 구현: 로딩 중 오버레이 표시
- 통합 검색 컴포넌트 확장: 로딩 상태 관리 통합, 에러 처리
- 노트 목록 페이지 업데이트: 검색 모드에서 스켈레톤 UI 표시
- 포괄적인 테스트 구현: 훅, 컴포넌트 테스트 완료

### File List
- `hooks/use-search-loading.ts` - 검색 로딩 상태 관리 훅 생성
- `components/ui/search-loading.tsx` - 검색 로딩 UI 컴포넌트 생성
- `components/notes/integrated-search.tsx` - 로딩 상태 관리 통합
- `app/notes/page.tsx` - 로딩 상태 UI 적용
- `__tests__/hooks/use-search-loading.test.ts` - 로딩 상태 관리 훅 테스트 생성
- `__tests__/components/ui/search-loading.test.tsx` - 로딩 UI 컴포넌트 테스트 생성

## QA Results
*이 섹션은 QA 에이전트가 검토 후 채워집니다*
